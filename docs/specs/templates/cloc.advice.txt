First, look for repetitive patterns that could be extracted into helper functions, or refactor to be more unit testable and concise.

Then split the remainder into smaller files by semantic concern (target 160–260 lines each). Identify distinct responsibilities—types, matching, classification, orchestration—and give each its own module. Prefer a folder with focused submodules over a single large file.

Avoid removing individual lines to satisfy the linter; prefer extracting testable code blocks.
